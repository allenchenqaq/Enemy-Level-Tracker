<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    
    <div class="game-panel">
        <div class="panel-title">Team Tracker</div>
        <div id="teamContainer" class="loading">Loading team data...</div>
    </div>

    <script>
        // Store previous state to detect changes
        let previousData = {};

        // Toast notification system
        function showToast(playerName, level) {
            const container = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            
            const icon = document.createElement('div');
            icon.className = 'toast-icon';
            icon.textContent = '⬆️';
            
            const content = document.createElement('div');
            content.className = 'toast-content';
            
            const title = document.createElement('div');
            title.className = 'toast-title';
            title.textContent = 'Level Up!';
            
            const message = document.createElement('div');
            message.className = 'toast-message';
            message.textContent = `${playerName} is level ${level} now`;
            
            content.appendChild(title);
            content.appendChild(message);
            toast.appendChild(icon);
            toast.appendChild(content);
            container.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Update UI with team data from JSON
        function updateTeamData(teamData) {
            const container = document.getElementById('teamContainer');
            container.innerHTML = '';
            container.classList.remove('loading');

            teamData.forEach((player, index) => {
                // Check if level increased for notification
                if (previousData[player.id] && previousData[player.id].level < player.level) {
                    showToast(player.name, player.level);
                }

                // Create player row
                const row = document.createElement('div');
                row.className = 'teammate-row';

                const info = document.createElement('div');
                info.className = 'teammate-info';

                const avatarContainer = document.createElement('div');
                avatarContainer.className = 'avatar-container';

                const avatar = document.createElement('div');
                avatar.className = `avatar avatar-${(index % 4) + 1}`;
                avatar.textContent = player.name.charAt(0).toUpperCase();

                const levelBadge = document.createElement('div');
                levelBadge.className = 'level-badge';
                levelBadge.textContent = player.level;

                const name = document.createElement('div');
                name.className = 'teammate-name';
                name.textContent = player.name;

                avatarContainer.appendChild(avatar);
                avatarContainer.appendChild(levelBadge);
                info.appendChild(avatarContainer);
                info.appendChild(name);
                row.appendChild(info);
                container.appendChild(row);

                // Store current state
                previousData[player.id] = { level: player.level };
            });
        }

        // Fetch data from API
        async function fetchTeamData() {
            try {
                const response = await fetch('http://localhost:3000/api/team');
                const data = await response.json();
                updateTeamData(data);
            } catch (error) {
                console.error('Error fetching team data:', error);
                document.getElementById('teamContainer').innerHTML = 
                    '<div class="loading">Failed to load data</div>';
            }
        }

        // Poll for updates every 2 seconds
        fetchTeamData();
        setInterval(fetchTeamData, 2000);

        // Example: Use mock data if API is not available
        // Uncomment below to test with mock data
        /*
        const mockData = [
            { id: 1, name: "Player Alpha", level: 6 },
            { id: 2, name: "Player Bravo", level: 11 },
            { id: 3, name: "Player Charlie", level: 8 },
            { id: 4, name: "Player Delta", level: 15 }
        ];
        updateTeamData(mockData);
        
        // Simulate level up after 3 seconds
        setTimeout(() => {
            mockData[0].level = 7;
            updateTeamData(mockData);
        }, 3000);
        */
    </script>
</body>
</html>